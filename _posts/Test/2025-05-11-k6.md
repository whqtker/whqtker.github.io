---
title : "[Test] k6"
date : 2025-05-11 10:40:00 +0900
categories : [Test]
tags : [test, spring boot, k6, ìŠ¤í”„ë§ ë¶€íŠ¸, ì„±ëŠ¥ í…ŒìŠ¤íŠ¸]
---

## ğŸ“Œ k6ë€?

`k6` ëŠ” Grafana Labsì—ì„œ ê°œë°œí•œ ì˜¤í”ˆì†ŒìŠ¤ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ë„êµ¬ì´ë‹¤. ë‹¤ì–‘í•œ ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìœ¼ë©°, í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ëŠ” `JavaScript` ë˜ëŠ” `TypeScript`ë¡œ ì‘ì„±ë˜ì–´ ë¹„êµì  ì‰½ê²Œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤. `Go` ì–¸ì–´ë¡œ ì‘ì„±ë˜ì–´ ë†’ì€ ì„±ëŠ¥ì„ ë³´ì¸ë‹¤. ë˜í•œ ë‹¤ë¥¸ ë„êµ¬ë“¤ì— ë¹„í•´ ì§ê´€ì ì´ë©° ê°„ë‹¨í•˜ë‹¤. í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ í„°ë¯¸ë„ì´ ì¶œë ¥í•˜ì—¬ ë³¼ ìˆ˜ë„ ìˆì§€ë§Œ `InfluxDB` ë‚˜ `Grafana` ì™€ ê°™ì€ ë„êµ¬ì™€ ì—°ë™í•˜ì—¬ ê²°ê³¼ë¥¼ ì €ì¥ ë° ë¶„ì„í•  ìˆ˜ ìˆë‹¤.

ë‹¤ë§Œ `Node.js` í™˜ê²½ì—ì„œëŠ” ì§ì ‘ì ìœ¼ë¡œ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤. ì • í•˜ê³  ì‹¶ë‹¤ë©´ `xk6-plugin` í™•ì¥ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

## ğŸ“Œ ì„±ëŠ¥ ì§€í‘œ

ì„¸ ê°€ì§€ ì„±ëŠ¥ ì§€í‘œê°€ ì¡´ì¬í•œë‹¤.

### Throughput (ì²˜ë¦¬ëŸ‰)

ì¼ì • ì‹œê°„ ë™ì•ˆ ì‹œìŠ¤í…œì´ ì–¼ë§ˆë‚˜ ë§ì€ ìš”ì²­ì„ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì§€í‘œì´ë‹¤. ì£¼ë¡œ ì‚¬ìš©í•˜ëŠ” ë‹¨ìœ„ëŠ” `TPS(Transactions Per Second)` , `RPS(Requests Per Second)` ê°€ ìˆë‹¤.

k6 ê²°ê³¼ì—ì„œ `http_reqs` ë¥¼ í†µí•´ ì „ì²´ ìš”ì²­ ìˆ˜ì™€ RPSë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

ë§Œì•½ 1ì´ˆ ë‹¹ 1,000ê°œì˜ íŠ¸ëœì­ì…˜ì´ ë°œìƒí–ˆë‹¤ë©´ ì´ë¥¼ 1000 TPSë¼ê³  í‘œí˜„í•  ìˆ˜ ìˆë‹¤.

### Latency (ì§€ì—°)

ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ìš”ì²­ì„ ë°›ì€ ì‹œì ë¶€í„° ì‘ë‹µì„ ì™„ë£Œí•˜ê¸°ê¹Œì§€ ê±¸ë¦¬ëŠ” ì‹œê°„ì„ ë‚˜íƒ€ë‚´ëŠ” ì§€í‘œì´ë‹¤. ê°„ë‹¨íˆ ë§í•´ ìš”ì²­ì´ ì²˜ë¦¬ë˜ëŠ” ë° ì†Œìš”ëœ ì´ ì‹œê°„ì´ë‹¤. ì§€ì—° ì‹œê°„ì´ ë‚®ì„ìˆ˜ë¡ ì‹œìŠ¤í…œì˜ ì‘ë‹µì´ ë¹ ë¥´ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.

k6 ê²°ê³¼ì—ì„œ ì§€ì—° ì‹œê°„ì˜ í‰ê· (avg), ìµœì†Œê°’(min), ì¤‘ì•™ê°’(med), ìµœëŒ€ê°’(max), ë°±ë¶„ìœ„ìˆ˜(p(90) or p(95))ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

### Iterations (ë°˜ë³µ)

í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ì— ì •ì˜ëœ ê¸°ë³¸ í•¨ìˆ˜ê°€ ì‹¤í–‰ëœ íšŸìˆ˜ì´ë‹¤. ì¦‰, `vu` (ê°€ìƒ ì‚¬ìš©ì)ê°€ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ëª‡ ë²ˆ ë°˜ë³µí–ˆëŠ”ì§€ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.

k6 ê²°ê³¼ì—ì„œ `iterations` ë¥¼ í†µí•´ ì´ ë°˜ë³µ íšŸìˆ˜ì™€ ì´ˆë‹¹ ë°˜ë³µ íšŸìˆ˜ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

## ğŸ“Œ ë©”íŠ¸ë¦­

### ìœ í˜•

k6ì—ëŠ” ë„¤ ê°€ì§€ ë©”íŠ¸ë¦­ ìœ í˜•ì´ ì¡´ì¬í•œë‹¤.

- `Counter`: ëˆ„ì  ê°’ì„ ì¶”ì í•˜ë©°, ê³„ì† ì¦ê°€í•˜ëŠ” ê°’ì„ ê°€ì§„ë‹¤. `http_reqs` ë“±ì´ ìˆë‹¤.
- `Gauge`: íŠ¹ì • ì‹œì ì˜ ê°’ì„ ì¸¡ì •í•˜ë©° ìµœì†Œ(min), ìµœëŒ€(max), ë§ˆì§€ë§‰(last) ê°’ì„ ì €ì¥í•œë‹¤. `vu` ë“±ì´ ìˆë‹¤.
- `Rate`: íŠ¹ì • ì´ë²¤íŠ¸ê°€ ì–¼ë§ˆë‚˜ ìì£¼ ë°œìƒí•˜ëŠ”ì§€ ë°±ë¶„ìœ¨ë¡œ í‘œì‹œí•œë‹¤. `checks` ë“±ì´ ìˆë‹¤.
- `Trend`: ì‹œê°„ ê²½ê³¼ì— ë”°ë¥¸ ê°’ì˜ ë³€í™”ë¥¼ ì¶”ì í•˜ê³  í‰ê· , ìµœì†Œ, ë°±ë¶„ìœ„ìˆ˜ì™€ ê°™ì€ í†µê³„ ì§€í‘œë¥¼ ê³„ì‚°í•œë‹¤. `http_req_duration` ë“±ì´ ìˆë‹¤.

### HTTP ê´€ë ¨ ë©”íŠ¸ë¦­

HTTP ìš”ì²­ì„ í•  ë•Œ ìƒì„±ë˜ëŠ” ë©”íŠ¸ë¦­ì´ë‹¤.

| **Metric Name** | **Type** | Description |
| --- | --- | --- |
| **http_reqs** | Counter | ìƒì„±í•œ ì´ HTTP ìš”ì²­ ìˆ˜ |
| **http_req_blocked** | Trend | ìš”ì²­ì„ ì‹œì‘í•˜ê¸° ì „ ëŒ€ê¸°í•œ ì‹œê°„ |
| **http_req_connecting** | Trend | ì›ê²© í˜¸ìŠ¤íŠ¸ì— TCP ì—°ê²°ì„ ì„¤ì •í•˜ëŠ” ë° ê±¸ë¦° ì‹œê°„ |
| **http_req_tls_handshaking** | Trend | TLS  í•¸ë“œì…°ì´í‚¹ì— ê±¸ë¦° ì‹œê°„ |
| **http_req_sending** | Trend | ì›ê²© í˜¸ìŠ¤íŠ¸ì— ë°ì´í„°ë¥¼ ì „ì†¡í•˜ëŠ” ë° ê±¸ë¦° ì‹œê°„ |
| **http_req_waiting** | Trend | ì›ê²© í˜¸ìŠ¤íŠ¸ì˜ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ë° ê±¸ë¦° ì‹œê°„(TTFB) |
| **http_req_receiving** | Trend | ì›ê²© í˜¸ìŠ¤íŠ¸ë¡œë¶€í„° ì‘ë‹µ ë°ì´í„°ë¥¼ ë°›ëŠ” ë° ê±¸ë¦° ì‹œê°„ |
| **http_req_duration** | Trend | ìš”ì²­ì— ê±¸ë¦° ì´ ì‹œê°„ (http_req_sending + http_req_waiting + http_req_receiving) |
| **http_req_failed** | Rate | ì‹¤íŒ¨í•œ HTTP ìš”ì²­ì˜ ë¹„ìœ¨ |

### ê¸°ë³¸ ë©”íŠ¸ë¦­

í”„ë¡œí† ì½œê³¼ ìƒê´€ì—†ì´ ìƒì„±ë˜ëŠ” ë©”íŠ¸ë¦­ì´ë‹¤.

| **Metric Name** | **Type** | **Description** |
| --- | --- | --- |
| **vus** | Gauge | í˜„ì¬ í™œì„±í™”ëœ ê°€ìƒ ì‚¬ìš©ì ìˆ˜ |
| **vus_max** | Gauge | ê°€ëŠ¥í•œ ìµœëŒ€ ê°€ìƒ ì‚¬ìš©ì ìˆ˜ |
| **iterations** | Counter | ê°€ìƒ ì‚¬ìš©ìê°€ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•œ ì´ íšŸìˆ˜ |
| **iteration_duration** | Trend | í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ë¥¼ í•œ ë²ˆ ì‹¤í–‰í•˜ëŠ” ë° ì†Œìš”ëœ ì‹œê°„ |
| **dropped_iterations** | Counter | VU ë˜ëŠ” ì‹œê°„ ë¶€ì¡±ìœ¼ë¡œ ì‹¤í–‰ë˜ì§€ ì•Šì€ ë°˜ë³µ íšŸìˆ˜ |
| **data_received** | Counter | ìˆ˜ì‹ ëœ ë°ì´í„°ì˜ ì–‘ |
| **data_sent** | Counter | ì „ì†¡ëœ ë°ì´í„°ì˜ ì–‘ |
| **checks** | Rate | ì„±ê³µì ì¸ ì²´í¬ì˜ ë¹„ìœ¨ |

## ğŸ“Œ í…ŒìŠ¤íŠ¸

ë‹¤ì–‘í•œ í…ŒìŠ¤íŒ… ë°©ë²•ì´ ì¡´ì¬í•œë‹¤. í…ŒìŠ¤íŠ¸ ëª©ì ì— ë”°ë¼ ì ì ˆí•œ ë°©ë²•ì„ ì„ íƒí•´ì•¼ í•œë‹¤.

- `Smoke Test`: í…ŒìŠ¤íŠ¸ì˜ í…ŒìŠ¤íŠ¸ì´ë‹¤. í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ì— ì˜¤ë¥˜ê°€ ì—†ëŠ”ì§€, ì‹œìŠ¤í…œì´ ìµœì†Œí•œì˜ ë¶€í•˜ì—ì„œ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ ê²€ì¦í•œë‹¤.
- `(Average) Load Test`: ì‹œìŠ¤í…œì´ íŠ¹ì • ë¶€í•˜ ì¡°ê±´ì—ì„œ ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” í…ŒìŠ¤íŠ¸ì´ë‹¤.
- `Stress Test`: í¬í™” ì§€ì ê³¼ ì²« ë²ˆì§¸ ë³‘ëª© ì§€ì ì„ ì‹ë³„í•˜ëŠ” í…ŒìŠ¤íŠ¸ì´ë‹¤. ê·¹í•œì˜ ì¡°ê±´ ë˜ëŠ” ê³¼ë„í•œ ë¶€í•˜ ìƒí™©ì„ ë¶€ì—¬í•œë‹¤.
- `Soak(Endurance) Test`: ì˜¤ëœ ì‹œê°„ í‰ê· ì ì¸ ë¶€í•˜ë¥¼ ì£¼ì—ˆì„ ë•Œ ì •ìƒì ìœ¼ë¡œ ì‹œìŠ¤í…œì´ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” í…ŒìŠ¤íŠ¸ì´ë‹¤.
- `Spike Test` : ì˜ˆìƒì¹˜ ëª»í•œ íŠ¸ë˜í”½ ê¸‰ì¦ì— ëŒ€í•œ ì‹œìŠ¤í…œì˜ ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” í…ŒìŠ¤íŠ¸ì´ë‹¤.
- `Breakpoint Test`: ì‹œìŠ¤í…œì˜ í•œê³„ì ì„ ì°¾ê¸° ìœ„í•œ í…ŒìŠ¤íŠ¸ì´ë‹¤. ì¼ë°˜ì ì¸ í…ŒìŠ¤íŠ¸ì™€ ë‹¬ë¦¬ ëª©í‘œ ë¶€í•˜ëŸ‰ì´ ì—†ë‹¤.

## ğŸ“Œ ì–´ë–»ê²Œ í…ŒìŠ¤íŒ… ê³„íšì„ ì„¸ì›Œì•¼ í•˜ëŠ”ê°€?

**ì •í•´ì§„ ì •ë‹µì€ ì—†ë‹¤.** ì„œë¹„ìŠ¤ì— ë§ê²Œ ì í•©í•œ í…ŒìŠ¤íŒ… ë°©ë²•ì„ ì„ íƒí•´ì•¼ í•œë‹¤. ë‹¤ë§Œ ì¢‹ì€ í…ŒìŠ¤íŒ…ì„ ìœ„í•´ ê³ ë ¤í•´ì•¼ í•  ì ë“¤ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

- í•˜ë‚˜ì˜ í…ŒìŠ¤íŒ… ë°©ë²•ìœ¼ë¡œ ëª¨ë“  ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ì—†ë‹¤. **ì—¬ëŸ¬ ë°©ë²•ì„ í†µí•©í•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•´ì•¼ í•œë‹¤.**
- ì´ˆë°˜ í…ŒìŠ¤íŒ…ì€ **Smoke Test**ë¡œ ì‹œì‘í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤. ìŠ¤í¬ë¦½íŠ¸ê°€ ì˜ˆìƒëŒ€ë¡œ ì˜ ë™ì‘í•˜ëŠ”ì§€ ë¨¼ì € ê²€ì¦í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
- ì£¼ìš” ì´ë²¤íŠ¸ ì „ **Spike Test**ë¥¼ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
- ìµœëŒ€ íŠ¸ë˜í”½ì—ì„œ ì •ê¸°ì ìœ¼ë¡œ **Load Test**ë¥¼ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
- `ramp-up`, `plateau`, `ramp-down`ê³¼ ê°™ì´ **ê°„ë‹¨í•œ ë¶€í•˜ íŒ¨í„´ì„ ì‚¬ìš©**í•œë‹¤. ë¶€í•˜ì˜ ì¦ê°ì´ ë§ì´ ë°”ë€ŒëŠ” ë¡¤ëŸ¬ì½”ìŠ¤í„° íŒ¨í„´ì€ í”¼í•˜ë¼.

> ramp-up: ì ì§„ì ìœ¼ë¡œ ë¶€í•˜ë¥¼ ì¦ê°€ì‹œí‚¤ëŠ” ë°©ë²•
plateau: ë¶€í•˜ë¥¼ ì¼ì • ìˆ˜ì¤€ìœ¼ë¡œ ìœ ì§€ì‹œí‚¤ëŠ” ë°©ë²•
ramp-down: ì ì§„ì ìœ¼ë¡œ ë¶€í•˜ë¥¼ ê°ì†Œì‹œí‚¤ëŠ” ë°©ë²•
> 

## ğŸ“Œ ì„¤ì¹˜

- Mac OS

```bash
brew install k6
```

- Window

```bash
choco install k6
```

ë˜ëŠ” ê³µì‹ í™ˆí˜ì´ì§€ ì„¤ì¹˜ ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ì—¬ ì„¤ì¹˜í•´ë„ ëœë‹¤.

https://grafana.com/docs/k6/latest/set-up/install-k6/

## ğŸ“Œ ì˜ˆì œ

### ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸

```jsx
import http from "k6/http";
import { sleep } from "k6";

export const options = {
    vus: 100, // ê°€ìƒ ì‚¬ìš©ì ìˆ˜
    duration: "10s", // í…ŒìŠ¤íŠ¸ ì‹œê°„
};

export default function () {
    http.get("http://localhost:8080/api/v1/posts");
    sleep(1);
}
```

`options` ì—ì„œ í…ŒìŠ¤íŠ¸ì— ëŒ€í•œ ì„¤ì •ì„ ëª…ì‹œí•œë‹¤.

`function` ì€ ê° vuê°€ ë°˜ë³µì ìœ¼ë¡œ ìˆ˜í–‰í•  ì‘ì—…ì´ë‹¤.

ìœ„ ì½”ë“œëŠ” 100ëª…ì˜ ê°€ìƒ ì‚¬ìš©ìê°€ 10ì´ˆ ë™ì•ˆ GET ìš”ì²­ì„ 1ì´ˆë§ˆë‹¤ ë³´ë‚´ëŠ” ìŠ¤í¬ë¦½íŠ¸ì´ë‹¤. `k6 run test1.js` ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

![image.png](assets/img/k6/1.png)

í…ŒìŠ¤íŠ¸ê°€ ìˆ˜í–‰ ì¤‘ì¼ ë•Œ ì¶œë ¥ë˜ëŠ” í™”ë©´ì´ë‹¤.

![image.png](assets/img/k6/2.png)

í…ŒìŠ¤íŠ¸ê°€ ì™„ë£Œë˜ë©´ ê²°ê³¼ì— ëŒ€í•œ ë©”íŠ¸ë¦­ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

`k6 run --out json=result.json test1.js` ë¥¼ ì‹¤í–‰í•˜ë©´ í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ JSON í˜•íƒœì˜ íŒŒì¼ë¡œ ì €ì¥í•œë‹¤.

---

```jsx
import http from "k6/http";
import { sleep } from "k6";
import { htmlReport } from "https://raw.githubusercontent.com/benc-uk/k6-reporter/main/dist/bundle.js";

export const options = {
    vus: 100,
    duration: "10s",
};

export default function () {
    http.get("http://localhost:8080/api/v1/posts");
    sleep(1);
}

// í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ htmlë¡œ ì¶”ì¶œ
export function handleSummary(data) {
    return {
        "result.html": htmlReport(data),
    };
}
```

test1.jsì™€ í…ŒìŠ¤íŠ¸ ë™ì‘ì€ ë™ì¼í•˜ë‚˜, í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ HTML í˜•íƒœë¡œ ì €ì¥í•œë‹¤.

### InfluxDB, Grafana ì—°ë™

```yaml
version: '3.4'

services:
  influxdb:
    image: influxdb:1.8
    ports:
      - "8086:8086"
    environment:
      - INFLUXDB_HTTP_AUTH_ENABLED=false
      - INFLUXDB_DB=k6

  grafana:
    image: grafana/grafana:latest
    ports:
      - "3000:3000"
    environment:
      - GF_AUTH_ANONYMOUS_ORG_ROLE=Admin
      - GF_AUTH_ANONYMOUS_ENABLED=true
      - GF_AUTH_BASIC_ENABLED=false
    volumes:
      - ./grafana:/etc/grafana/provisioning/
```

docker-composeë¥¼ ì‚¬ìš©í•˜ì—¬ InfluxDBì™€ Grafanaë¥¼ ì„¤ì¹˜í•œë‹¤.

---

Grafanaì— InfluxDBë¥¼ ì—°ê²°í•œë‹¤.

![image.png](assets/img/k6/3.png)

localhost:3000ì— ì ‘ì†í•˜ë©´ ìœ„ì™€ ê°™ì€ Grafana ëŒ€ì‹œë³´ë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ìš°ì¸¡ì— Coonection - Data sourcesë¥¼ í´ë¦­í•œë‹¤.

![image.png](assets/img/k6/4.png)

ìš°ì¸¡ ìƒë‹¨ì— Add new data sourceë¥¼ í´ë¦­í•œë‹¤.

![image.png](assets/img/k6/5.png)

InfluxDBë¥¼ í´ë¦­í•œë‹¤.

![image.png](assets/img/k6/6.png)

HTTPì—ì„œ URLì„ `http://influxdb:8086` ë¡œ, Databaseë¥¼ k6ë¡œ ì„¤ì •í•œë‹¤.

---

Grafana ëŒ€ì‹œë³´ë“œ í…Œë§ˆ ì¤‘ í•˜ë‚˜ë¥¼ ì ìš©ì‹œí‚¤ì.

![image.png](assets/img/k6/7.png)

Dashboards ë©”ë‰´ì—ì„œ ìš°ì¸¡ ìƒë‹¨ì— New - New dashboardë¥¼ í´ë¦­í•œë‹¤.

![image.png](assets/img/k6/8.png)

ìš°ì¸¡ í•˜ë‹¨ì— import dashboardë¥¼ í´ë¦­í•œë‹¤.

![image.png](assets/img/k6/9.png)

`https://grafana.com/grafana/dashboards/2587` ë¥¼ ë¶™ì—¬ë„£ê³  Load ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.

![image.png](assets/img/k6/10.png)

Import ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.

---

ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œì˜ ë™ì‘ì„ Grafanaë¥¼ í†µí•´ í™•ì¸í•˜ì.

```jsx
import http from 'k6/http';
import { sleep } from 'k6';

// 3ë¶„ ë™ì•ˆ 7000ê°œì˜ vuê°€ ìš”ì²­ì„ ì ì§„ì ìœ¼ë¡œ ë³´ëƒ„
export const options = {
    stages: [
        { duration: '3m', target: 7000 }
    ],
};

export default function () {
    http.get('http://localhost:8080/api/v1/posts');
    sleep(1);
}
```

![image.png](assets/img/k6/11.png)

`K6_WEB_DASHBOARD=true k6 run test3.js` ë¥¼ í†µí•´ í…ŒìŠ¤íŠ¸ ê³¼ì •ì„ ì›¹ ëŒ€ì‹œë³´ë“œì—ì„œ ë³¼ ìˆ˜ ìˆë‹¤. k6ì—ì„œ ì œê³µí•˜ëŠ” ì›¹ ëŒ€ì‹œë³´ë“œì´ë‹¤.

![image.png](assets/img/k6/12.png)

`k6 run --out influxdb=localhost:8086/k6 test3.js` ë¥¼ í†µí•´ í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ InfluxDBì— ì €ì¥í•˜ê³ , Grafana ëŒ€ì‹œë³´ë“œì—ì„œ ì´ë¥¼ ì‹œê°í™”í•˜ì—¬ ë³¼ ìˆ˜ ìˆë‹¤.

### Load Test

```jsx
import http from "k6/http";
import { check } from "k6";

export const options = {
    stages: [
        { duration: "1m", target: 20 }, // 1ë¶„ ë™ì•ˆ vu 20ëª…ê¹Œì§€ ì¦ê°€
        { duration: "1m", target: 20 }, // 1ë¶„ ë™ì•ˆ 20ëª… ìœ ì§€
        { duration: "1m", target: 50 }, // 1ë¶„ ë™ì•ˆ 50ëª…ê¹Œì§€ ì¦ê°€
        { duration: "1m", target: 50 }, // 1ë¶„ ë™ì•ˆ í”¼í¬ ìœ ì§€
    ],

    thresholds: {
        http_req_duration: ["p(95)<200"], // 95%ì˜ ìš”ì²­ì´ 200ms ì´í•˜ë¡œ ì‘ë‹µí•´ì•¼ ì„±ê³µ
    },
};

export default function () {
    const response = http.get("http://localhost:8080/api/v1/posts");

    // ìƒíƒœ ì½”ë“œê°€ 200ì´ë©´ ì„±ê³µ
    check(response, {
        "success": (res) => res.status === 200,
    });
}
```

vu ìˆ˜ë¥¼ ì ì§„ì ìœ¼ë¡œ ì¦ê°€ì‹œí‚¤ê³ , ìœ ì§€í•˜ë©´ì„œ ì‹œìŠ¤í…œì˜ ì„±ëŠ¥ì„ ì¸¡ì •í•œë‹¤.

`stages` ë¥¼ í†µí•´ ì‹œê°„ì— ë”°ë¥¸ vu ìˆ˜ë¥¼ ì¡°ì ˆí•œë‹¤.

`thresholds` ëŠ” í…ŒìŠ¤íŠ¸ì˜ ì„±ê³µ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ëŠ” ê¸°ì¤€ì´ë‹¤.

`check` ë¥¼ í†µí•´ ìš”ì²­ì´ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.

### Stress Test

```jsx
import http from "k6/http";
import { check } from "k6";

export const options = {
    stages: [
        { duration: "1m", target: 20 },
        { duration: "1m", target: 20 },
        { duration: "1m", target: 40 },
        { duration: "1m", target: 40 },
        { duration: "1m", target: 50 },
        { duration: "1m", target: 50 },
    ],

    thresholds: {
        http_req_duration: ["p(95)<300"],
    },
};

export default function () {
    const response = http.get("http://localhost:8080/api/v1/posts");
    check(response, {
        "success": (res) => res.status === 200,
    });
}
```

vu ìˆ˜ë¥¼ ì¦ê°€ì‹œí‚¤ë©´ì„œ breakpointë¥¼ ì°¾ëŠ”ë‹¤.

## ğŸ“Œ ê¹ƒí—ˆë¸Œ ë§í¬

https://github.com/whqtker/practice-k6