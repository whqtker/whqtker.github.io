---
title : "[JPA] QueryDSL"
date : 2025-05-18 10:10:00 +0900
categories : [Java]
tags : [java, ìë°”, jpa, querydsl, spring boot, ìŠ¤í”„ë§ ë¶€íŠ¸]
---

## ğŸ“Œ QueryDSLì´ë€?

`QueryDSL`ì€ `HQL(Hibernate Query Language)`ë¥¼ **íƒ€ì…ì— ì•ˆì „í•˜ê²Œ(type-safe)** ìƒì„± ë° ê´€ë¦¬í•˜ëŠ” í”„ë ˆì„ì›Œí¬ì´ë‹¤. ì •ì  íƒ€ì…ì„ í†µí•´ SQLì´ë‚˜ JPQL ì¿¼ë¦¬ë¥¼ ìë°” ì½”ë“œë¡œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤. 

> ì •ì  íƒ€ì…ì´ë€ **ì»´íŒŒì¼ ì‹œì ì— ë³€ìˆ˜ë‚˜ ê°ì²´ì˜ ë°ì´í„° íƒ€ì…ì´ ë¯¸ë¦¬ ê²°ì •**ë˜ëŠ” ê²ƒì„ ë§í•œë‹¤.
> 

â€˜type-safeâ€™ë¼ëŠ” ê²ƒì€ **ì»´íŒŒì¼ëŸ¬ê°€ í”„ë¡œê·¸ë¨ ì‹¤í–‰ ì „ ë°ì´í„° íƒ€ì…ì„ í™•ì¸**í•˜ì—¬ íƒ€ì… ì˜¤ë¥˜ë¥¼ ë°©ì§€í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤. 

DSLì€ Domain-Specific Languageì˜ ì•½ìë¡œ, íŠ¹ì • ë„ë©”ì¸ì— ì´ˆì ì„ ë§ì¶˜ ì†Œí”„íŠ¸ì›¨ì–´ ì–¸ì–´ì´ë‹¤. QueryDSLì—ì„œ ë„ë©”ì¸ì´ë€ ë°ì´í„°ë² ì´ìŠ¤ë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤.

## ğŸ“Œ ë“±ì¥ ë°°ê²½

QueryDSL ì´ì „ì—ëŠ” Mybatis, JPQL, Criteriaê³¼ ê°™ì´ ë¬¸ìì—´ í˜•íƒœë¡œ ì¿¼ë¦¬ë¬¸ì„ ì‘ì„±í•˜ì˜€ë‹¤. ë”°ë¼ì„œ ì»´íŒŒì¼ ì‹œì ì— ì˜¤ë¥˜ë¥¼ ë°œê²¬í•˜ëŠ” ê²ƒì´ ë¶ˆê°€ëŠ¥í–ˆê³ , ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë ¤ì›Œì¡Œë‹¤. ê³µì‹ JPAì—ì„œ ì œê³µí•˜ëŠ” Criteria APIëŠ” ì¿¼ë¦¬ë¥¼ ìë°” ì½”ë“œë¡œ ì‘ì„±í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•˜ì§€ë§Œ, ì½”ë“œê°€ ë‚œí•´í•˜ê³  ì§ê´€ì„±ì´ ë–¨ì–´ì§„ë‹¤ëŠ” ë‹¨ì ì´ ìˆì—ˆë‹¤. ë˜í•œ ì‹¤ë¬´ì—ì„œëŠ” ë‹¤ì–‘í•œ ì¡°ê±´ì˜ ë™ì  ì¿¼ë¦¬ì˜ í•„ìš”ì„±ì´ ì¦ê°€í•˜ì˜€ë‹¤. ì´ëŸ¬í•œ ë¬¸ì œë“¤ì„ í•´ê²°í•˜ê¸° ìœ„í•´ QueryDSLì´ ë“±ì¥í•˜ì˜€ë‹¤.

## ğŸ“Œ ì¥ì 

- ë¬¸ìì—´ì´ ì•„ë‹Œ **ì½”ë“œë¡œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ì—¬ ì»´íŒŒì¼ ì‹œì ì— ì˜¤ë¥˜ë¥¼ ì°¾ì•„ë‚¼ ìˆ˜ ìˆë‹¤.**
- Q-Class, ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë³µì¡í•œ ì¿¼ë¦¬ë‚˜ ë™ì  ì¿¼ë¦¬ ì‘ì„±ì„ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.
- JPQL ë¬¸ë²•ê³¼ ìœ ì‚¬í•œ í˜•íƒœë¡œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.

## ğŸ“Œ Q-Class

`Q-Class` ëŠ” QueryDSLì´ ì œê³µí•˜ëŠ” **ë©”íƒ€ ëª¨ë¸ í´ë˜ìŠ¤**ì´ë‹¤. ì—”í‹°í‹° í´ë˜ìŠ¤ì˜ êµ¬ì¡°ì™€ í•„ë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìë™ìœ¼ë¡œ ìƒì„±ë˜ë©°, ê° ì—”í‹°í‹°ì˜ í•„ë“œ ì •ë³´ë¥¼ ë³€ìˆ˜ë¡œ ê°€ì§„ë‹¤.

> ë©”íƒ€ ëª¨ë¸ í´ë˜ìŠ¤ëŠ” íŠ¹ì • ëª¨ë¸ì˜ êµ¬ì¡°ë¥¼ ì»´íŒŒì¼ ì‹œì ì— ì •ì ìœ¼ë¡œ í‘œí˜„í•˜ëŠ” í´ë˜ìŠ¤ì´ë‹¤. ì´ë¥¼ í†µí•´ í•„ë“œëª… ì˜¤íƒ€, íƒ€ì… ë¶ˆì¼ì¹˜ ë“±ê³¼ ê°™ì€ ì˜¤ë¥˜ë¥¼ ì‹¤í–‰ ì „ì— ë°œê²¬í•  ìˆ˜ ìˆê²Œ ëœë‹¤.
> 

ì—”í‹°í‹° í´ë˜ìŠ¤ì— `@Entity` ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì–´ìˆë‹¤ë©´ Q-ClassëŠ” ë¹Œë“œ ì‹œì ì— `JPAAnnotationProcessor` ì— ì˜í•´ ìë™ìœ¼ë¡œ ìƒì„±ëœë‹¤. Q-ClassëŠ” ì—”í‹°í‹° ì´ë¦„ ì•ì— â€˜Qâ€™ê°€ ë¶™ì–´ ìƒì„±ëœë‹¤. ë§Œì•½ ì—”í‹°í‹° ì´ë¦„ì´ `User` ë¼ë©´ í•´ë‹¹ ì—”í‹°í‹°ì˜ Q-ClassëŠ” `QUser` ê°€ ëœë‹¤.

> JPAAnnotationProcessorëŠ” `APT(Annotation Processing Tool)` ì´ë‹¤. APTëŠ” Java ì»´íŒŒì¼ëŸ¬ì˜ ì¼ë¶€ë¡œ, ì»´íŒŒì¼ ì‹œì ì— ì–´ë…¸í…Œì´ì…˜ì„ ë¶„ì„í•˜ê³  ì¶”ê°€ì ì¸ ì½”ë“œë¥¼ ìƒì„±í•˜ëŠ” ë„êµ¬ì´ë‹¤. ë‹¤ë¥¸ ì˜ˆì‹œë¡œ Lombokì˜ `@Getter` ê°€ ìˆë‹¤.
> 

```java
@Entity
public class Member {
    @Id
    private Long id;
    private String username;
    private int age;
}

public class QMember extends EntityPathBase<Member> {
    public static final QMember member = new QMember("member");
    public final StringPath username = createString("username");
    public final NumberPath<Integer> age = createNumber("age", Integer.class);
    public final NumberPath<Long> id = createNumber("id", Long.class);
}
```

ì»´íŒŒì¼ ì‹œì ì— ìœ„ì™€ ê°™ì€ Q-Classê°€ ìƒì„±ëœë‹¤. 

`JPAQueryFactory` ë¥¼ ì‚¬ìš©í•˜ì—¬ Q-Class ê¸°ë°˜ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ë¹Œë” íŒ¨í„´ìœ¼ë¡œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.

```java
JPAQueryFactory queryFactory = new JPAQueryFactory(em);
QMember member = QMember.member;
Member result = queryFactory
    .selectFrom(member)
    .where(member.username.eq("whqtker"))
    .fetchOne();

```

<aside>
ğŸ’¡

JPAQueryFactory ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ë°©ë²•ì€ ë‘ ê°€ì§€ê°€ ìˆë‹¤. ìœ„ ì½”ë“œì™€ ê°™ì´ EntityManager ê°ì²´ë¡œ ìƒì„±í•˜ëŠ” ë°©ë²•ì´ ìˆê³ , Beanìœ¼ë¡œ ë“±ë¡í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ë„ ìˆë‹¤. Beanìœ¼ë¡œ ë“±ë¡í•˜ëŠ” ë°©ë²•ì€ ì•„ë˜ì™€ ê°™ë‹¤.

</aside>

```java
@Configuration
public class QueryDSLConfig {
    @Bean
    JPAQueryFactory jpaQueryFactory(EntityManager em) {
        return new JPAQueryFactory(em);
    }
}

```

## ğŸ“Œ QueryDSL ì„¤ì •

```groovy
    // QueryDSL
    implementation 'com.querydsl:querydsl-jpa:5.0.0:jakarta'
    annotationProcessor "com.querydsl:querydsl-apt:${dependencyManagement.importedProperties['querydsl.version']}:jakarta"
    annotationProcessor "jakarta.annotation:jakarta.annotation-api"
    annotationProcessor "jakarta.persistence:jakarta.persistence-api"
```

`dependencies` ì— QueryDSL ì˜ì¡´ì„±ì„ ì¶”ê°€í•œë‹¤.

```groovy
clean {
    delete file('src/main/generated')
}
```

ìœ„ ì½”ë“œë¥¼ ì¶”ê°€í•˜ë©´ `gradle clean` ëª…ë ¹ìœ¼ë¡œ ìƒì„±ëœ Q-Classë¥¼ ìë™ìœ¼ë¡œ ì‚­ì œí•  ìˆ˜ ìˆë‹¤.

## ğŸ“Œ ê¸°ë³¸ ë¬¸ë²•

```java
QMember member = QMember.member;
Member result = queryFactory
    .selectFrom(member)
    .where(member.username.eq("member1"))
    .fetchOne();

```

QueryDSLì€ ê¸°ë³¸ì ìœ¼ë¡œ **ë©”ì„œë“œ ì²´ì´ë‹**ì„ í†µí•´ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•œë‹¤.

`selectFrom()` : ì¡°íšŒí•  ì—”í‹°í‹°ë¥¼ ì§€ì •í•œë‹¤.

`where()` : ì¡°ê±´ì ˆì„ ì¶”ê°€í•œë‹¤.

`fetchOne()` : ë‹¨ì¼ ê²°ê³¼ë¥¼ ë¦¬í„´í•œë‹¤.

### ì¡°ê±´

```java
.where(
    member.age.between(10, 30)
    .and(member.username.like("%user%"))
)

```

whereì ˆì— ì‚¬ìš© ê°€ëŠ¥í•œ ë©”ì„œë“œ ì¤‘ ì¼ë¶€ë§Œ ì‚´í´ë³´ì.

`eq()`: ê°’ì´ ê°™ì€ì§€ ë¹„êµí•œë‹¤.

`ne()`: ê°’ì´ ë‹¤ë¥¸ì§€ ë¹„êµí•œë‹¤.

`goe()`: ì´ìƒ(â‰¥)

`lt()`: ë¯¸ë§Œ(<)

`like()`: ë¬¸ìì—´ íŒ¨í„´ì„ ë§¤ì¹­í•  ë•Œ ì‚¬ìš©í•œë‹¤.

**ì¡°ê±´ì„ nullë¡œ ì„¤ì •í•˜ëŠ” ê²½ìš° í•´ë‹¹ ì¡°ê±´ì€ ë¬´ì‹œëœë‹¤.**

### ì¡°íšŒ

```java
QueryResults<Member> results = queryFactory
    .selectFrom(member)
    .fetchResults();

```

`fetch()`: ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ë¥¼ ë¦¬í„´í•œë‹¤. ë¦¬í„´ íƒ€ì…ì€ `List<T>` ì´ë‹¤.

`fetchOne()`: ë‹¨ì¼ ê²°ê³¼ ê°ì²´ë¥¼ ë¦¬í„´í•œë‹¤. ê²°ê³¼ê°€ ì—†ë‹¤ë©´ `null`, ê²°ê³¼ê°€ ë‘˜ ì´ìƒì´ë¼ë©´ `NonUniqueResultException`ì„ ë°œìƒì‹œí‚¨ë‹¤.

`fetchFirst()`: ì¿¼ë¦¬ ê²°ê³¼ì—ì„œ ì²« ë²ˆì§¸ ê²°ê³¼ë§Œ ë¦¬í„´í•œë‹¤. `limit(1).fetchOne()` ê³¼ ë™ì¼í•œ ë™ì‘ì„ ìˆ˜í–‰í•œë‹¤. ê²°ê³¼ê°€ ì—†ë‹¤ë©´ `null` ì„ ë¦¬í„´í•œë‹¤.

`fetchResults()`: ì¿¼ë¦¬ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ì™€ ì „ì²´ ê°œìˆ˜ë¥¼ ë¦¬í„´í•œë‹¤. ë¦¬í„´ íƒ€ì…ì€ `QueryResults<T>` ì´ë©°, ë‚´ë¶€ì ìœ¼ë¡œ `getResults()`, `getTotal()` ì´ ìˆ˜í–‰ëœë‹¤. ë‹¨, ì„±ëŠ¥ì ìœ¼ë¡œ ë¬¸ì œê°€ ìˆìœ¼ë¯€ë¡œ ì‚¬ìš©ì„ ì§€ì–‘í•œë‹¤.

> ê·¸ë£¹í™”ë¥¼ ì‚¬ìš©í•œ ë³µì¡í•œ ì¿¼ë¦¬ì—ì„œ ì •í™•í•œ ì „ì²´ ê°œìˆ˜ë¥¼ íŒŒì•…í•˜ê¸° ì–´ë µê³ , **ì „ì²´ ê²°ê³¼ë¥¼ ë©”ëª¨ë¦¬ì— ë¡œë“œí•œ í›„ `size()` ë¡œ ê°œìˆ˜ë¥¼ ê³„ì‚°í•˜ë¯€ë¡œ ì„±ëŠ¥ì´ ì €í•˜ë  ê°€ëŠ¥ì„±ì´ ì¡´ì¬**í•˜ê¸° ë•Œë¬¸ì´ë‹¤. `fetch()` í›„ ë³„ë„ì˜ count ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.
> 

`fetchCount()` : ì¡°íšŒ ì¿¼ë¦¬ë¥¼ count ì¿¼ë¦¬ë¡œ ë³€í™˜í•˜ì—¬ ê°œìˆ˜ë¥¼ ë¦¬í„´í•œë‹¤.

> ë‚´ë¶€ì ìœ¼ë¡œ `fetch().size()` ë¡œ ì²˜ë¦¬ë  ê°€ëŠ¥ì„±ì´ ìˆì–´ ì„±ëŠ¥ ë¬¸ì œê°€ ë°œìƒí•œë‹¤. ì´ìœ ëŠ” ë™ì¼í•˜ë‹¤.
> 

### ì •ë ¬ê³¼ í˜ì´ì§•

```java
List<Member> members = queryFactory
    .selectFrom(member)
    .orderBy(member.age.desc(), member.username.asc().nullsLast())
    .offset(10)
    .limit(5)
    .fetch();

```

`orderBy()` : ì •ë ¬ ìˆœì„œë¥¼ ì§€ì •í•œë‹¤.

`nullsLast()`: null ê°’ì„ ë§ˆì§€ë§‰ì— ë°°ì¹˜í•œë‹¤.

`offset()`: ì¿¼ë¦¬ ê²°ê³¼ì—ì„œ ëª‡ ë²ˆì§¸ í–‰ë¶€í„° ë¦¬í„´í• ì§€ ì§€ì •í•œë‹¤.

`limit()`: ìµœëŒ€ ëª‡ ê°œì˜ í–‰(í˜ì´ì§€ í¬ê¸°)ì„ ë¦¬í„´í• ì§€ ì§€ì •í•œë‹¤.

### ì§‘ê³„ í•¨ìˆ˜ì™€ ê·¸ë£¹í™”

```java
List<Tuple> result = queryFactory
    .select(
        team.name,
        member.age.avg()
    )
    .from(member)
    .join(member.team, team)
    .groupBy(team.name)
    .having(member.age.avg().gt(20))
    .fetch();

```

`groupBy()`, `having()`: ê·¸ë£¹í™”í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ë©”ì„œë“œì´ë‹¤. `avg()` ê³¼ ê°™ì´ ë‹¤ì–‘í•œ ì§‘ê³„ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

### Projections

```java
List<Tuple> result = queryFactory
    .select(member.username, member.age)
    .from(member)
    .fetch();
```

ì „ì²´ ì—”í‹°í‹°ê°€ ì•„ë‹Œ í•„ìš”í•œ í•„ë“œë§Œ ì„ íƒí•˜ì—¬ ê²°ê³¼ë¥¼ ë¦¬í„´í•˜ëŠ” ê²½ìš° `Projections` ë¥¼ ì‚¬ìš©í•œë‹¤. QueryDSLì˜ `Tuple` ê°ì²´ë¥¼ í†µí•´ í•„ë“œë¥¼ ì¡°íšŒí•œë‹¤.

ê²°ê³¼ë¥¼ DTOë¡œ ë³€í™˜í•˜ëŠ” ë°©ë²•ì€ í¬ê²Œ 4ê°€ì§€ê°€ ì¡´ì¬í•œë‹¤.

1\. `Projections.constructor()` 

```java
List<MemberDto> result = queryFactory
    .select(Projections.constructor(
        MemberDto.class,
        member.username,
        member.age
    ))
    .from(member)
    .fetch();

```

DTOì˜ ìƒì„±ìë¥¼ í™œìš©í•˜ì—¬ ì¿¼ë¦¬ ê²°ê³¼ë¥¼ ë§¤í•‘í•˜ëŠ” ë°©ë²•ì´ë‹¤. **ìƒì„±ìë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë§¤í•‘í•˜ë¯€ë¡œ ë¶ˆë³€ DTOë¥¼ ìƒì„±**í•  ìˆ˜ ìˆë‹¤. ë‹¨, ì»´íŒŒì¼ íƒ€ì„ì— ì˜¤ë¥˜ ê²€ì¶œì´ ì–´ë µê³ , **ë§¤ê°œë³€ìˆ˜ ìˆœì„œë¥¼ ì¼ì¹˜ì‹œì¼œì•¼ í•œë‹¤.** ìˆœì„œê°€ ì¼ì¹˜í•˜ì§€ ì•Šìœ¼ë©´ `IllegalArgumentException` ì´ ë°œìƒí•œë‹¤.

> ë¶ˆë³€ DTOëŠ” í•œ ë²ˆ ìƒì„±ëœ í›„ ë‚´ë¶€ ìƒíƒœë¥¼ ë³€ê²½í•  ìˆ˜ ì—†ëŠ” DTOë¥¼ ë§í•œë‹¤. ëª¨ë“  í•„ë“œëŠ” `final` ë¡œ ì„ ì–¸ëœë‹¤.
> 

2\. `Projections.fields()`

```java
List<MemberDto> result = queryFactory
    .select(Projections.fields(
        MemberDto.class,
        member.username,
        member.age
    ))
    .from(member)
    .fetch();

```

DTOì˜ í•„ë“œì— ì§ì ‘ ì ‘ê·¼í•˜ì—¬ ì¿¼ë¦¬ ê²°ê³¼ë¥¼ ë§¤í•‘í•˜ëŠ” ë°©ë²•ì´ë‹¤. **DTOì˜ í•„ë“œëª…ê³¼ ì¿¼ë¦¬ ê²°ê³¼ì˜ í•„ë“œëª…ì´ ì¼ì¹˜í•˜ë©´ ìë™ìœ¼ë¡œ ë§¤í•‘**ëœë‹¤. ì§ì ‘ ê°’ì„ ì£¼ì…í•˜ë¯€ë¡œ Setterê°€ í•„ìš” ì—†ë‹¤. ë‹¨, DTOì— `@NoArgsConstructor` ê°€ í•„ìˆ˜ë¡œ ëª…ì‹œë˜ì–´ì•¼ í•œë‹¤.

3\. `Projections.bean()`

```java
List<MemberDto> result = queryFactory
    .select(Projections.bean(
        MemberDto.class,
        member.username,
        member.age
    ))
    .from(member)
    .fetch();

```

**DTOì˜ Setterë¥¼ í†µí•´ ì¿¼ë¦¬ ê²°ê³¼ë¥¼ ë§¤í•‘**í•˜ëŠ” ë°©ë²•ì´ë‹¤. ë”°ë¼ì„œ Setterì™€ ê¸°ë³¸ ìƒì„±ìê°€ í•„ìˆ˜ë¡œ ëª…ì‹œë˜ì–´ì•¼ í•œë‹¤.

4\. `@QueryProjection`

```java
@Getter
public class UserDTO {
    private String username;
    private int age;

    @QueryProjection
    public UserDTO(String username, int age) {
        this.username = username;
        this.age = age;
    }
}

List<UserDTO> dtos = queryFactory
    .select(new QUserDTO(member.username, member.age))
    .from(member)
    .fetch();

```

DTOì˜ ìƒì„±ìì— `@QueryProjection` ì„ ì¶”ê°€í•˜ë©´ **QueryDSLì´ í•´ë‹¹ DTOì— ëŒ€í•œ Q-Classë¥¼ ìë™ìœ¼ë¡œ ìƒì„±**í•˜ì—¬ ì¿¼ë¦¬ ê²°ê³¼ë¥¼ type-safeí•˜ê²Œ ë§¤í•‘í•  ìˆ˜ ìˆë‹¤. ìƒì„±ì ê¸°ë°˜ì´ë¯€ë¡œ Setter ì—†ì´ **ë¶ˆë³€ DTOë¥¼ ìƒì„±**í•  ìˆ˜ ìˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ê°€ì¥ ì¶”ì²œí•˜ëŠ” ë°©ë²•ì´ë‹¤.

### BooleanBuilder

```java
BooleanBuilder builder = new BooleanBuilder();
if (username != null) {
    builder.and(member.username.eq(username));
}
if (minAge != null) {
    builder.and(member.age.goe(minAge));
}

List<Member> result = queryFactory
    .selectFrom(member)
    .where(builder)
    .fetch();

```

ì¡°ê±´ì„ ìœ ë™ì ìœ¼ë¡œ ì¡°í•©í•˜ê³  ì‹¶ì€ ê²½ìš° `BooleanBuilder` ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. `and()` ë‚˜ `or()` ì„ í†µí•œ ë©”ì„œë“œ ì²´ì´ë‹ ë°©ë²•ìœ¼ë¡œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.

```java
BooleanBuilder builder = new BooleanBuilder(Expressions.TRUE);

```

ì¡°ê±´ì´ í•˜ë‚˜ë„ ì¶”ê°€ë˜ì§€ ì•ŠëŠ” ê²½ìš° ìœ„ì™€ ê°™ì´ ì‘ì„±í•œë‹¤. `WHERE 1=1` ê³¼ ë™ì¼í•œ íš¨ê³¼ë¥¼ ê°€ì§„ë‹¤.

ì„±ëŠ¥ì„ ìµœì í™”í•˜ê¸° ìœ„í•´ **ìì£¼ ê±¸ëŸ¬ì§€ëŠ” ì¡°ê±´ì„ ë¨¼ì € ì‘ì„±í•˜ì—¬ ë°ì´í„°ì˜ ë²”ìœ„ë¥¼ ë¹ ë¥´ê²Œ ì¶•ì†Œí•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.**

### ì¡°ì¸

```java
List<Order> orders = queryFactory
    .selectFrom(order)
    .join(order.member, member)
    .leftJoin(order.product, product)
    .where(member.age.gt(30))
    .fetch();

```

QueryDSLì—ì„œ ì¡°ì¸ì€ JPQLê³¼ ìœ ì‚¬í•œ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤. `join()`, `innerjoin()`, `leftjoin()`, `fetchJoin()`ë“±ê³¼ ê°™ì€ ì¡°ì¸ ë©”ì„œë“œê°€ ì¡´ì¬í•˜ë©°, `on()` ì„ í†µí•´ ì¡°ì¸ ì¡°ê±´ì„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.

### ì„œë¸Œì¿¼ë¦¬

```java
// SELECT ì ˆ ì„œë¸Œì¿¼ë¦¬
List<Tuple> result = queryFactory
    .select(
        member.username,
        JPAExpressions.select(memberSub.age.max())
                     .from(memberSub)
    )
    .from(member)
    .fetch();

// WHERE ì ˆ ì„œë¸Œì¿¼ë¦¬
List<Member> result = queryFactory
    .selectFrom(member)
    .where(member.age.eq(
        JPAExpressions.select(memberSub.age.max())
                     .from(memberSub)
    ))
    .fetch();

// FROM ì ˆ ì„œë¸Œì¿¼ë¦¬
QMember memberSub = new QMember("memberSub");
List<Member> result = queryFactory
    .selectFrom(member)
    .from(JPAExpressions.selectFrom(memberSub)
                       .where(memberSub.age.gt(10)), member)
    .fetch();

```

`JPAExpressions` ë¥¼ í†µí•´ ì„œë¸Œì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤. ì„œë¸Œì¿¼ë¦¬ëŠ” SELECT, WHERE, FROM ì ˆì— ì‘ì„±ë  ìˆ˜ ìˆë‹¤.

ë‹¨, FROM ì ˆ ì„œë¸Œì¿¼ë¦¬ëŠ” Hibernate 6 ë¯¸ë§Œì—ì„œëŠ” ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤.

### ì¡°ê±´ ë¶„ê¸°

```java
List<String> result = queryFactory
    .select(new CaseBuilder()
        .when(member.age.between(10, 20)).then("10ëŒ€")
        .when(member.age.between(20, 30)).then("20ëŒ€")
        .otherwise("ê¸°íƒ€"))
    .from(member)
    .fetch();

```

`CaseBuilder` ë¥¼ í†µí•´ ë³µì¡í•œ ì¡°ê±´ ë¶„ê¸°ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤. SQLë¬¸ì—ì„œ `CASE WHEN` êµ¬ë¬¸ê³¼ ê°™ì€ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•œë‹¤.

### ìˆ˜ì • ë° ì‚­ì œ

```java
long count = queryFactory
        .update(member)
        .set(member.name, newName)
        .where(member.name.eq(oldName))
        .execute();

```

`update()` ì™€ `delete()` ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ìˆ˜ì • ë° ì‚­ì œí•  ìˆ˜ ìˆë‹¤. `execute()` ë¥¼ í†µí•´ ë©”ì„œë“œì— ì˜í–¥ì„ ë°›ì€ í–‰ì˜ ìˆ˜ë¥¼ ë¦¬í„´í•œë‹¤.

## ğŸ“Œ ì°¸ê³ 

https://velog.io/@evan523/JPA-QueryDSL